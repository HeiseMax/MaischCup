{% extends "base.html" %}

{% block title %}Fencing Score Sheet{% endblock %}

{% block styles %}
<style>
    .win {
          background-color: #a8e6a3;
      }
      .loss {
          background-color: #e6a3a3;
      }
</style>
{% endblock %}

{% block content %}
  <body>
    <div class="container">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Nummer</th>
            {% for player in players %}
            <th title="{{ player.name }}">{{ loop.index }}</th>
            {% endfor %}
            <th>Gewonnen</th>
            <th>Verloren</th>
            <th>Offen</th>
          </tr>
        </thead>
        <tbody>
          {% for player in players %}
          <tr>
            <!-- Player Details -->
            <td>{{ player.name }}</td>
            <td>{{ loop.index }}</td>

            <!-- Matchup Results -->
            {% for opponent in players %}
            <!-- Black cell for same player -->
            {% if player.id == opponent.id %}
            <td class="dark-cell">---</td>

            {% else %} {% set score = scores|selectattr('player1_id', 'equalto',
            player.id)|selectattr('player2_id', 'equalto', opponent.id)|first%}
            <td
              class="{% if score %} {% if score.win %}win{% else %}loss{% endif %}{% endif %}"
            >
              {% if score %} {% if score.win %} V{{ score.score1 }}
              <br />-<br />
              D{{score.score2 }} {% else %} D{{ score.score1 }} <br />-<br />
              V{{ score.score2}} {% endif %} {% else %} - {% endif %}
            </td>
            {% endif %} {% endfor %}
            <td>{{ won_matches[player.id] }}</td>
            <td>{{ lost_matches[player.id] }}</td>
            <td>{{ remaining_matches[player.id] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="result-form">
        <h2>Submit Match Result</h2>
        <form method="POST" action="/update_score">
          <label for="player1_id">Player 1:</label>
          <select name="player1_id" id="player1_id">
            {% for player in players %}
            <option value="{{ player.id }}" {% if session.get('player_id') == player.id %}selected{% endif %}>{{ player.name }}</option>
            {% endfor %}
          </select>
          <label for="player2_id">Player 2:</label>
          <select name="player2_id" id="player2_id">
            {% for player in players %}
            <option value="{{ player.id }}">{{ player.name }}</option>
            {% endfor %}
          </select>
          <label for="score1">Player 1 Score:</label>
          <input type="number" name="score1" id="score1" min="0" max="5" />
          <label for="score2">Player 2 Score:</label>
          <input type="number" name="score2" id="score2" min="0" max="5" />
          <button type="submit">Submit</button>
        </form>
      </div>

      <div class="add-player-form">
        <h2>Add New Player</h2>
        <form method="GET" action="/add_player">
          <button type="submit">Teilnehmer hinzuf√ºgen</button>
        </form>
        {% with messages = get_flashed_messages() %} {% if messages %}
        <ul>
          {% for message in messages %}
          <li>{{ message }}</li>
          {% endfor %}
        </ul>
        {% endif %} {% endwith %}
      </div>
    </div>
  </body>
{% endblock %}